<!DOCTYPE html>
<html>
<head>
<title>State Chart</title>
<meta name="description" content="A finite state machine chart with editable and interactive features." />
<!-- /* Copyright 1998-2016 by Northwoods Software Corporation. */ -->
<meta charset="UTF-8">
<script src="samples/go.js"></script>
<!-- 
<link href="assets/css/goSamples.css" rel="stylesheet" type="text/css" /> <!-- you don't need to use this -->
<!-- <script src="assets/js/goSamples.js"></script>  --> <!-- this is only for the GoJS Samples framework -->
<script type="text/javascript">

</script>
<script id="code">
  function init() {
    
    var $ = go.GraphObject.make;  // for conciseness in defining templates
    var bigfont = "bold 13pt Helvetica, Arial, sans-serif";
    var smallfont = "bold 11pt Helvetica, Arial, sans-serif";
    var redgrad = $(go.Brush, "Linear", { 0: "#C45245", 1: "#871E1B" });
    function textStyle() {
        return {
          margin: 6,
          wrap: go.TextBlock.WrapFit,
          textAlign: "center",
          editable: true,
          font: bigfont
        }
      }
    
    myDiagram =
      $(go.Diagram, "myDiagramDiv",  // must name or refer to the DIV HTML element
        {
          // start everything in the middle of the viewport
          initialContentAlignment: go.Spot.Center,
          // have mouse wheel events zoom in and out instead of scroll up and down
          "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
          // support double-click in background creating a new node
          "clickCreatingTool.archetypeNodeData": { text: "new node" },
          // enable undo & redo
          "undoManager.isEnabled": true
        });

    // when the document is modified, add a "*" to the title and enable the "Save" button
    myDiagram.addDiagramListener("Modified", function(e) {
      var button = document.getElementById("SaveButton");
      if (button) button.disabled = !myDiagram.isModified;
      var idx = document.title.indexOf("*");
      if (myDiagram.isModified) {
        if (idx < 0) document.title += "*";
      } else {
        if (idx >= 0) document.title = document.title.substr(0, idx);
      }
    });

    
    var reasonTemplate = $(go.Panel, "Horizontal",
  	      $(go.TextBlock, "Reason",
  	        {
  	          margin: new go.Margin(4,0,0,0),
  	          maxSize: new go.Size(200, NaN),
  	          wrap: go.TextBlock.WrapFit,
  	          stroke: "whitesmoke",
  	          editable: true,
  	          font: smallfont
  	        },
  	        new go.Binding("text", "text").makeTwoWay())
  	      );
    
    
    // define the Node template
    myDiagram.nodeTemplate =
      $(go.Node, "Auto",
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        // define the node's outer shape, which will surround the TextBlock
        $(go.Shape, "RoundedRectangle",
          {
            parameter1: 20,  // the corner has a large radius
            fill: $(go.Brush, "Linear", { 0: "rgb(254, 201, 0)", 1: "rgb(254, 162, 0)" }),
            stroke: null,
            portId: "",  // this Shape is the Node's port, not the whole Node
            fromLinkable: true, fromLinkableSelfNode: true, fromLinkableDuplicates: true,
            toLinkable: true, toLinkableSelfNode: true, toLinkableDuplicates: true,
            cursor: "pointer"
          }),
          
         $(go.Panel, "Vertical", {defaultAlignment: go.Spot.TopLeft},
        		  
         $(go.TextBlock,
           	{
            font: "bold 11pt helvetica, bold arial, sans-serif",
            editable: true  // editing the text automatically updates the model data
            },
          new go.Binding("text").makeTwoWay()
          ),
          
         $(go.Panel, "Vertical",
            { 
        	defaultAlignment: go.Spot.TopLeft,
            itemTemplate: reasonTemplate 
            },
            new go.Binding("itemArray", "reasonsList").makeTwoWay()
         )
  )
      );

 // unlike the normal selection Adornment, this one includes a Button
    myDiagram.nodeTemplate.selectionAdornmentTemplate =
      $(go.Adornment, "Spot",
        $(go.Panel, "Auto",
          $(go.Shape, { fill: null, stroke: "blue", strokeWidth: 2 }),
          $(go.Placeholder)  // a Placeholder sizes itself to the selected Node
        ),
        
        
        // the button to create a "next" node, at the bottom-right corner
        $("Button",
          {
            alignment: go.Spot.BottomRight,
            click: addReason  // this function is defined below
          },
          $(go.Shape, "TriangleDown", { width: 6, height: 6 })
        ), // end button
        
        // the button to create a "next" node, at the top-right corner
        $("Button",
          {
            alignment: go.Spot.TopRight,
            click: addNodeAndLink  // this function is defined below
          },
          $(go.Shape, "PlusLine", { width: 6, height: 6 })
        ) // end button
     
        
      ); // end Adornment

   
    
      


    	    
    
    
    
    
    // clicking the button inserts a new node to the right of the selected node,
    // and adds a link to that new node
    function addNodeAndLink(e, obj) {
      var adornment = obj.part;
      var diagram = e.diagram;
      diagram.startTransaction("Add State");

      // get the node data for which the user clicked the button
      var fromNode = adornment.adornedPart;
      var fromData = fromNode.data;
      // create a new "State" data object, positioned off to the right of the adorned Node
      var toData = { text: "new" };
      var p = fromNode.location.copy();
      p.x += 200;
      toData.loc = go.Point.stringify(p);  // the "loc" property is a string, not a Point object
      // add the new node data to the model
      var model = diagram.model;
      model.addNodeData(toData);

      // create a link data from the old node data to the new node data
      var linkdata = {
        from: model.getKeyForNodeData(fromData),  // or just: fromData.id
        to: model.getKeyForNodeData(toData),
        text: "transition"
      };
      // and add the link data to the model
      model.addLinkData(linkdata);

      // select the new Node
      var newnode = diagram.findNodeForData(toData);
      diagram.select(newnode);

      diagram.commitTransaction("Add State");

      // if the new node is off-screen, scroll the diagram to show the new node
      diagram.scrollToRect(newnode.actualBounds);
    }
      
      
    function addReason(e, obj) {
        var adorn = obj.part;
        var diagram = e.diagram;
        var model = diagram.model;
        
        if (adorn === null) return;
        e.handled = true;
        var arr = adorn.adornedPart.data.reasonsList;
        diagram.startTransaction("add reason");
        model.addArrayItem(arr, {});
        diagram.commitTransaction("add reason");
      }

    // replace the default Link template in the linkTemplateMap
    myDiagram.linkTemplate =
      $(go.Link,  // the whole link panel
        {
          curve: go.Link.Bezier, adjusting: go.Link.Stretch,
          reshapable: true, relinkableFrom: true, relinkableTo: true,
          toShortLength: 3
        },
        new go.Binding("points").makeTwoWay(),
        new go.Binding("curviness"),
        $(go.Shape,  // the link shape
          { strokeWidth: 1.5 }),
        $(go.Shape,  // the arrowhead
          { toArrow: "standard", stroke: null }),
        $(go.Panel, "Auto",
          $(go.Shape,  // the label background, which becomes transparent around the edges
            {
              fill: $(go.Brush, "Radial",
                      { 0: "rgb(240, 240, 240)", 0.3: "rgb(240, 240, 240)", 1: "rgba(240, 240, 240, 0)" }),
              stroke: null
            }),
          $(go.TextBlock, "transition",  // the label text
            {
              textAlign: "center",
              font: "9pt helvetica, arial, sans-serif",
              margin: 4,
              editable: true  // enable in-place editing
            },
            // editing the text automatically updates the model data
            new go.Binding("text").makeTwoWay())
        )
      );

    // read in the JSON data from the "mySavedModel" element
    load();
  }

  // Show the diagram's model in JSON format
  function save() {
    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
  }
  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
  }
</script>
</head>
<body onload="init()">
<div id="sample" style="height:800px">
  <div id="myDiagramDiv" style="border: solid 1px black; width: 100%; height: 100%;"></div>
  <!-- 
  <p>
    This sample creates state charts, and more specifically, finite-state machines.
    A <em>finite-state machine</em> is a mathematical model of computation used to design
    computer programs and sequential logic circuits.
  </p>
  <p>
    The text is editable for both the nodes and the links.
    The user can draw as many links from one node to another node as desired,
    and the links can be reshaped or deleted when selected.
    Double-clicking in the background of the diagram creates a new node.
    The mouse wheel is set to zoom in and out instead of scroll.
  </p>
  <p>
    This sample customizes the <a>Part.selectionAdornmentTemplate</a>
    of the node to a template that contains a button
    The button is positioned to be at the Top-Right corner of the node by
    being in a Spot Panel with its <a>GraphObject.alignment</a> property set to Spot.TopRight.
  </p>
  <p>
    The Button's <a>GraphObject.click</a> method creates a new node data,
    adds it to the model, and creates a link from the original node data to the new node data.
    All of this is done inside a transaction, so that it can be undone by the user
    (Ctrl+Z and Ctrl+Y will undo and redo transactions). After the node is created,
    <a>Diagram.scrollToRect</a> is called in case it is off-screen.
  </p>
   -->
  <div>
    <div>
      <button id="SaveButton" onclick="save()">Save</button>
      <button onclick="load()">Load</button>
      Diagram Model saved in JSON format:
    </div>
    <textarea id="mySavedModel" style="width:100%;height:100%;display:none">
{ "nodeKeyProperty": "id",
  "nodeDataArray": [
{"text":"Stream LiveTV", "id":-8, "loc":"-425.260399577344 70.56000000000003"},
{"text":"Manual Control", "id":-7, "loc":"-293.26500000000016 72.76500000000006"},
{"text":"Start/Stop", "id":-9, "loc":"-153.24750000000006 74.97000000000004"},
{"text":"Test Monitor", "id":-10, "loc":"-50.71499999999992 76.07250000000008"},
{"text":"Test Execution", "id":-11, "loc":"-248.06250000000006 173.09250000000006"},
{"text":"Test Run\nMgmt", "id":-6, "loc":"160.8114768750001 61.26151500000003"},
{"text":"Test Suite\nMgmt", "id":-12, "loc":"257.7450615468751 59.92141935937504"},
{"text":"Test case\nMgmt", "id":-13, "loc":"365.01652687500047 61.26151500000002"},
{"text":"Test Manager", "id":-14, "loc":"268.01912812500024 150.60122437500013"},
{"text":"Server\nConfig", "id":-15, "loc":"509.2363434375004 63.81407812500005"},
{"text":"STB\nConfig", "id":-16, "loc":"597.2997712500005 65.09035968750008"},
{"text":"Channel/Program\nConfig", "id":-17, "loc":"677.7055096875006 67.6429228125001"},
{"text":"Manual Setup", "id":-18, "loc":"578.1555478125003 155.70635062500014"},
{"text":"Test Run\nReport", "id":-19, "loc":"866.6262823238271 77.86464908374698"},
{"text":"Test Script\nReport", "id":-20, "loc":"962.6767244254681 74.92915283176234"},
{"text":"Report", "id":-21, "loc":"921.9543587560325 161.2605680509668"},
{"text":"Test\nController", "id":-22, "loc":"-361.6248086226565 337.7041014375002"},
{"text":"Test agent", "id":-23, "loc":"243.42837311953133 472.78574201250035"},
{"text":"Execution Engine", "id":-24, "loc":"220.91476635703128 381.324214539844"},
{"text":"Control Engine", "id":-25, "loc":"22.51360676249999 320.8188963656252"},
{"text":"Verification Engine", "id":-26, "loc":"225.13606762500018 303.93369129375014"},
{"text":"Keycode", "id":-27, "loc":"23.920707185156232 239.20707185156266"},
{"text":"Navigation", "id":-28, "loc":"147.74554437890635 240.61417227421884"},
{"text":"UI Recognition", "id":-29, "loc":"333.48280016953146 237.79997142890642"},
{"text":"A/V Recognition", "id":-30, "loc":"478.4141437031253 237.79997142890642"},
{"text":"Report", "id":-31, "loc":"727.4709185132817 477.00704328046913"},
{"text":"Library API", "id":-32, "loc":"614.9028847007817 310.96919340703147"},
{"text":"MySQL", "id":-33, "loc":"1011.7052038898446 448.865034827344"},
{"text":"Configuration", "id":-34, "loc":"641.6377927312503 249.0567748101564"}

 ],
  "linkDataArray": [
{"from":-8, "to":-11, "points":[-309.45139877028845,108.0181909648337,-284.2736685980388,116.58002409356835,-246.99872861963667,138.02748667534073,-206.53511422626553,173.26414062191648]},
{"from":-7, "to":-11, "points":[-209.84302977672127,111.31766970651344,-196.18011922136003,125.59821210498887,-187.21850748331715,146.1713166561815,-185.64642551809277,173.0933502873721]},
{"from":-9, "to":-11, "points":[-113.56402742717997,113.62859419363443,-124.91930576964117,143.4162497897517,-140.78876484002916,163.29942667328805,-155.81931665375564,173.315237247826]},
{"from":-10, "to":-11, "points":[-19.85342134290798,114.57039585014294,-63.39720540412578,148.3556562496706,-101.69645245928575,167.9798548754334,-127.78490670408412,175.68424476939617]},
{"from":-6, "to":-14, "points":[245.31236310725933,103.3460325691317,267.01964332852606,111.16848370472232,286.83135813202335,124.33344490185515,309.8201002593968,150.7242065027757]},
{"from":-12, "to":-14, "points":[324.3205576727123,114.11462626557778,330.29618891970244,122.18390045744535,333.5590717147927,134.32479484228583,330.36142650823695,150.61059227014238]},
{"from":-13, "to":-14, "points":[394.33220762321105,115.48871567666131,381.3747747492091,138.52919260942815,369.34595322520056,150.34675106262486,368.1537343771957,150.89296594814724]},
{"from":-15, "to":-18, "points":[577.0360699663453,106.98096036243871,596.1721794058149,116.3411269754845,611.4575088278584,130.17441467587503,626.1417507451507,155.7726433540455]},
{"from":-16, "to":-18, "points":[645.2685332037499,119.33305227529418,650.6196035082883,130.5531395528162,651.3295810106443,142.66191137214415,645.6215026759725,155.7480522139968]},
{"from":-17, "to":-18, "points":[727.0960027947906,121.81052501873395,705.7569087423755,146.18668642794452,689.63158616119,157.5849611924313,688.841919055702,157.84803751657222]},
{"from":-19, "to":-21, "points":[941.8136581331871,129.68745993261626,946.4892470182546,133.27719281766716,952.6598787172865,143.03034637712045,955.0086516138163,161.26466517613943]},
{"from":-20, "to":-21, "points":[1004.5889858967571,129.20184995891958,999.0127982147131,149.01799882944053,991.5290369525945,159.75785548379378,985.6635068231866,163.35146749379865]},
{"from":-11, "to":-22, "points":[-193.6210707882715,211.73609237102954,-217.97564578667613,263.3593753486462,-249.68987688449758,305.40000518090704,-285.167622047666,337.9037708282937]},
{"from":-22, "to":-23, "points":[-267.5379795145387,371.24743071021186,-93.69503439317532,394.8902192052695,76.98992420637182,430.73700989379375,246.2415199534995,479.183969980597]},
{"from":-23, "to":-24, "points":[285.8077998064932,472.8059404658073,278.37679021674563,448.7743816355163,280.08055282532297,429.8960903802966,285.0955969915707,419.96996733201905]},
{"from":-25, "to":-27, "points":[72.54464846035879,320.91970416886255,71.13931106438574,319.2419336888234,65.28681611117757,302.9878135459321,66.02923621061925,277.89845920750474]},
{"from":-25, "to":-28, "points":[103.95254254037992,320.9433316540571,127.71299564497235,293.6093274206553,148.14836807689858,279.4853924516674,154.9600002486987,277.0453978575922]},
{"from":-24, "to":-25, "points":[221.53371196258945,392.0520799385064,197.85085858130722,389.23413219752433,169.01266085342297,380.80080909524634,125.51443646094091,359.2324031513488]},
{"from":-26, "to":-29, "points":[315.132001868971,304.0087641790348,320.57270123184117,292.7230279537506,331.7477776933621,282.7181070699886,349.87103179159544,276.1784954642928]},
{"from":-26, "to":-30, "points":[355.4375136054814,304.2627038941851,427.5432861746058,277.80966989373746,476.3766002401267,266.3410957340492,479.1119245090616,266.0583956841225]},
{"from":-32, "to":-24, "points":[619.8345233202367,345.68888880566084,537.4920540638986,372.8908448792477,453.32142721293064,388.97805692845805,367.0048179337025,395.31458765979187]},
{"from":-24, "to":-31, "points":[366.47001259680263,408.98019276135483,489.5532573373853,423.85868383265716,610.4702126883042,448.55268877882315,728.8159552117128,485.38050288868544]},
{"from":-31, "to":-33, "points":[798.0266088996074,488.02350207776203,872.0928823158167,470.93145523417616,941.9148004574927,464.2014127428489,1011.7057255838982,466.5399930764032]},
{"from":-24, "to":-33, "points":[367.0058824476462,403.08870737638205,583.0370248827145,410.84094407351034,797.982204936769,430.01483735227805,1011.7112216868713,462.4898677711264]},
{"from":-34, "to":-24, "points":[659.3868869975571,287.4535045656109,557.3160168264462,333.05007441825217,457.98983595303616,365.3993621309752,362.8351977684631,385.9090758144836]},
{"from":-24, "to":-26, "points":[287.14422760702496,381.3527070989771,281.9148377868697,366.53261941778356,283.45215407983824,353.6305670012937,290.6587209721722,342.5442946309394]},
{"from":-33, "to":-21, "points":[1039.142233644063,448.9128724061119,1001.3016132814204,369.6217222064878,975.1674458109807,286.6407122732097,960.7363776490403,199.94510037838214]},
{"from":-14, "to":-33, "points":[377.1740399476213,187.54881008201545,592.6730889185957,263.0586626522967,806.8581475917275,351.50555638989067,1016.6333218862911,452.7967892542268]},
{"from":-18, "to":-33, "points":[669.6922201968946,194.15111992477063,790.0946174594808,265.4278194953757,909.8165339682598,350.6599818734387,1025.8478974508325,449.0399500373375]},
{"from":-33, "to":-24, "points":[1011.7112738568939,462.4646755201837,798.0005135245386,429.845084561429,583.0566300692091,410.6369036370057,367.0058940279374,403.0369824105327]}
 ]
}
    </textarea>
  </div>
</div>
</body>
</html>
